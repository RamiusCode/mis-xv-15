<section class="relative bg-white text-black w-full overflow-x-hidden">
  <div class="relative w-full xl:px-40 overflow-hidden" id="flores-arriba-hero" style="opacity: 1 !important;">
    <img
      src="/imagenes/FloresArriba.webp"
      alt="Flores decorativas"
      class="w-full h-auto object-cover object-center block"
      style="opacity: 1 !important;"
    />

    <div
      class="absolute left-1/2 transform -translate-x-1/2 top-[100px] sm:top-16 md:top-12 lg:top-8 xl:top-80 z-50"
      id="corona-hero"
    >
      <img
        src="/imagenes/Corona.webp"
        alt="Corona de quinceañera"
        class="w-24 h-auto sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32 xl:w-56 xl:h-36 object-contain mx-auto"
      />
    </div>
  </div>

  <div class="relative w-full overflow-hidden px-4">
    <div class="flex justify-center w-full">
      <div class="text-center z-10 max-w-4xl w-full">

        <div class="relative text-center z-30 mb-8 w-full" id="titulo-container-hero">
          <h1
            class="font-crimson text-2xl sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl text-[#95303a] font-bold tracking-wider"
            id="titulo-hero"
          >
            MIS XV AÑOS
          </h1>
        </div>

        <div
          class="flex items-center justify-center gap-4 sm:gap-8 md:gap-16 lg:gap-24 mb-8 w-full"
          id="nombre-container-hero"
        >
          <div id="mariposa-izq-hero" class="flex-shrink-0">
            <img
              src="/gif/MariposaRoja.gif"
              alt="Mariposa izquierda"
              class="w-10 h-auto sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 object-contain"
            />
          </div>

          <h2
            class="font-great-vibes text-8xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl text-[#a27735] tracking-wide flex-shrink min-w-0"
            id="nombre-typewriter-hero"
          ></h2>

          <div id="mariposa-der-hero" class="flex-shrink-0">
            <img
              src="/gif/MariposaRoja.gif"
              alt="Mariposa derecha"
              class="w-10 h-auto sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 object-contain scale-x-[-1]"
            />
          </div>
        </div>

        <div class="relative w-full overflow-visible" id="foto-container-hero">
          <div id="flores-foto-izq-hero" class="absolute -left-4 sm:left-0 top-32 sm:top-24 md:top-20 lg:top-16 flex-shrink-0 z-30">
            <img
              src="/imagenes/FloresIzquierda.webp"
              alt="Flores izquierda"
              class="w-20 h-auto sm:w-24 md:w-32 lg:w-40 object-contain"
            />
          </div>

          <div id="flores-foto-der-hero" class="absolute -right-4 sm:right-0 top-32 sm:top-24 md:top-20 lg:top-16 flex-shrink-0 z-30">
            <img
              src="/imagenes/FloresDerecha.webp"
              alt="Flores derecha"
              class="w-20 h-auto sm:w-24 md:w-32 lg:w-40 object-contain"
            />
          </div>

          <div class="relative flex justify-center">
            <img
              src="/imagenes/xv.webp"
              alt="Foto de quinceañera"
              class="w-full max-w-[65vw] h-auto sm:max-w-[55vw] md:max-w-[45vw] lg:max-w-[35vw] xl:max-w-[30vw] object-contain"
              id="foto-quinceañera-hero"
            />
          </div>
        </div>

      </div>
    </div>
  </div>

</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  let heroScrollTrigger = null;
  let butterflyAnimations = [];

  // Detectar móvil
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

  if (isMobile) {
    ScrollTrigger.config({
      autoRefreshEvents: "visibilitychange,DOMContentLoaded,load,resize",
      ignoreMobileResize: true
    });
  }

  function initHeroAnimations() {
    console.log("✨ Iniciando animaciones del Hero...");

    // Destruir animaciones anteriores
    if (heroScrollTrigger) {
      heroScrollTrigger.kill();
    }
    butterflyAnimations.forEach(anim => anim.kill());
    butterflyAnimations = [];

    // Estado inicial
    gsap.set("#flores-arriba-hero", { clearProps: "all" });
    gsap.set("#corona-hero", { opacity: 0, scale: 0.5 });
    gsap.set("#titulo-hero", { opacity: 0, y: 30 });
    gsap.set("#mariposa-izq-hero", { opacity: 0, x: -50, y: 20, rotation: -15, scale: 0.8 });
    gsap.set("#mariposa-der-hero", { opacity: 0, x: 50, y: 20, rotation: 15, scale: 0.8 });
    gsap.set("#nombre-typewriter-hero", { opacity: 0 });
    gsap.set("#flores-foto-izq-hero", { opacity: 0, x: -150 });
    gsap.set("#flores-foto-der-hero", { opacity: 0, x: 150 });
    gsap.set("#foto-container-hero", { opacity: 0, scale: 0.8, y: 30 });

    function animateHeroIn() {
      const tl = gsap.timeline();

      // FLORES ARRIBA
      tl.to("#flores-arriba-hero", {
        opacity: 1,
        duration: 1,
        ease: "power2.out"
      });

      // CORONA - Zoom in
      tl.to("#corona-hero", {
        opacity: 1,
        scale: 1,
        duration: 1.2,
        ease: "back.out(1.2)"
      }, "-=0.7");

      // TÍTULO
      tl.to("#titulo-hero", {
        opacity: 1,
        y: 0,
        duration: 1,
        ease: "power2.out"
      }, "-=0.5");

      // MARIPOSAS
      tl.to("#mariposa-izq-hero", {
        opacity: 1,
        x: 0,
        y: 0,
        rotation: 0,
        scale: 1,
        duration: 1.5,
        ease: "power2.out"
      }, "-=0.8");

      tl.to("#mariposa-der-hero", {
        opacity: 1,
        x: 0,
        y: 0,
        rotation: 0,
        scale: 1,
        duration: 1.5,
        ease: "power2.out"
      }, "-=1.5");

      // NOMBRE
      tl.add(() => {
        nombreCascadaElegante();
      }, "-=1");

      // FLORES LATERALES
      tl.to("#flores-foto-izq-hero", {
        opacity: 1,
        x: 0,
        duration: 1.5,
        ease: "power2.out"
      }, "-=1.2");

      tl.to("#flores-foto-der-hero", {
        opacity: 1,
        x: 0,
        duration: 1.5,
        ease: "power2.out"
      }, "-=1.5");

      // FOTO PRINCIPAL
      tl.to("#foto-container-hero", {
        opacity: 1,
        scale: 1,
        y: 0,
        duration: 1.2,
        ease: "power2.out"
      }, "-=1");

      // ANIMACIONES CONTINUAS
      tl.add(() => {
        startButterflyFloating();
      });
    }

    function startButterflyFloating() {
      const anim1 = gsap.to("#mariposa-izq-hero", {
        y: -12,
        rotation: 3,
        duration: 3,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1
      });

      const anim2 = gsap.to("#mariposa-izq-hero", {
        x: 10,
        duration: 4,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1
      });

      const anim3 = gsap.to("#mariposa-der-hero", {
        y: -12,
        rotation: -3,
        duration: 3,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1
      });

      const anim4 = gsap.to("#mariposa-der-hero", {
        x: -10,
        duration: 4,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1
      });

      butterflyAnimations.push(anim1, anim2, anim3, anim4);
    }

    function nombreCascadaElegante() {
      const texto = "Lucia";
      const contenedor = document.getElementById("nombre-typewriter-hero");
      if (!contenedor) return;

      contenedor.innerHTML = texto
        .split("")
        .map(
          (letra, index) =>
            `<span class="letra-cascada-hero" style="
                opacity: 0; 
                display: inline-block; 
                transform: translateY(30px) scale(0.8);
                filter: blur(2px);
            ">${letra}</span>`
        )
        .join("");

      gsap.to(".letra-cascada-hero", {
        opacity: 1,
        y: 0,
        scale: 1,
        filter: "blur(0px)",
        duration: 0.8,
        ease: "back.out(1.6)",
        stagger: { each: 0.12, from: "start" }
      });
    }

    // ScrollTrigger - Aparece inmediatamente
    heroScrollTrigger = ScrollTrigger.create({
      trigger: "section",
      start: "top 100%",
      end: "bottom top",
      
      invalidateOnRefresh: true,
      anticipatePin: 1,
      fastScrollEnd: true,
      
      onEnter: () => {
        console.log('✨ Hero apareciendo...');
        animateHeroIn();
      },
      
      once: true
    });

    // Ejecutar inmediatamente
    animateHeroIn();
  }

  // INICIALIZACIÓN
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeroAnimations);
  } else {
    initHeroAnimations();
  }

  // Refresh
  window.addEventListener('load', () => {
    setTimeout(() => {
      ScrollTrigger.refresh();
      console.log("🔄 ScrollTrigger refreshed - Hero");
    }, 100);
  });

  // Cleanup
  window.addEventListener('beforeunload', () => {
    if (heroScrollTrigger) {
      heroScrollTrigger.kill();
    }
    butterflyAnimations.forEach(anim => anim.kill());
  });
</script>

<style>
  #flores-arriba-hero,
  #flores-arriba-hero img {
    opacity: 1 !important;
  }

  .letra-cascada-hero {
    transition: all 0.3s ease;
    will-change: transform, opacity, filter;
    position: relative;
  }

  .letra-cascada-hero:hover {
    transform: translateY(-3px) scale(1.05) !important;
    text-shadow: 0 0 12px rgba(162, 119, 53, 0.5) !important;
  }
</style>